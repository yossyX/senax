# キャッシュ

## エンティティキャッシュ
テーブルのデータとリレーション先のデータをまとめてキャッシュします。
リレーション先は1世代のみです。

## ショートキャッシュ
insertされたデータが必ずしも参照されるとは限らないので、参照されるまでTTLの短いショートキャッシュに保存されます。

## 高速キャッシュ
エンティティキャッシュをノンブロッキングでより高速に参照できるキャッシュです。  
キャッシュのみのベンチマークでは高速ですが、全体としての影響は未確認です。  

## ディスクキャッシュ
キャッシュをディスクに保存します。保存先はSSDを想定しています。  
io_uringを使用しているため、Linuxのみ対応。  
ディスクキャッシュに保存されている位置を示すインデックス領域をメモリ上に必要とするため、大容量のディスクキャッシュは難しいかもしれません。  
ホットデプロイではディスクキャッシュの再利用を行わず、別ファイルとなります。瞬時にディスクキャッシュがフルになって2倍の容量を必要とすることはないと思われますが、前のサーバが速やかに終了しない場合問題が発生する可能性があります。  
単純な追記書き込みのため、容量効率はよくありませんが、下記2点に特化しています。

* ディスクキャッシュ上に保存されているかの判定がメモリ上で瞬時に可能
* 指定されたディスク容量を絶対にオーバーしない

## バージョンキャッシュ
キャッシュの更新とDBからの取得がほぼ同時の場合に不整合が発生していないかの確認のため、バージョン機能を有効にしている場合にバージョンナンバーをキャッシュします。

## ユニークインデックスキャッシュ
ユニークインデックスがある場合、ユニークインデックスからIDを検索するためのユニークインデックスキャッシュを使用します。

## ダミーキャッシュ
「いいね！」などの表示は押されていなければデータが無いのでキャッシュされず、何度も再取得されることになる。  
その場合、「いいね！」を解除した状態のデータを insert_dummy_cache で登録することで代わりのキャッシュとすることができる。

## キャッシュ更新通知
_receive_update_notice で他のサーバからのキャッシュ更新通知を受信することができます。新着やランキングの修正、チャット通知などに利用できます。 